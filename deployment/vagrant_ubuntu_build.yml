---
# this is mainly a wrapper playbook to allow provisioning via
# vagrant, the actual work is done in the roles (which can be
# applied to other hosts, i.e. cloud instances)
- hosts: all
  gather_facts: False
  vars:
    ansible_python_interpreter: python2.7
    builduser_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC2RZOUp1dtjr1YvHjKr8bxxy0lrM+5Zj154Nd6IXosTSVjIKcpjOVpbWd/1UNVBdnlk5dvLrdz68DvlU1fnh0TGK0T5m5ww53bZSRWZqM5i2Z3MywEeLALDAlt7F8gjvu8dfNHlLr54VW3t0JFMgsyYrJ/N4PQcCrdgmoyMUpKd5ZKJ5nd12JSHejEXqSNK+j1HFZpVFF5GQoB4HrNy4Eu1rmpDVl6EVIwMy55F5OGrxbp56SVvmVMK5rQvz5gvUQSzGwnwO6xygF28jiaIX5DSjOqDBTvstODE1CSHGRenKdlnpQ8k5PVvPJnTKW8XqZwM0qz0a7r4k+U69TP7e3KvLEhuEVs8IAWC2MeqpIuaAu6MSar8WqZfDXbMRMVl2ngrjS1xOSncWSocI6gVmZEeY5wEW2bRfTaUyM0wQ7d0mIMGuMu8xRqu+Tn8N7Bq6Y5VR6iENtwHqZfTgRO9UnBMM2G+2fLvgpGzo4622Mm6TGEL6i3QLRg+IU/Pk7KtLI1mxRqhwr0VzUaPts30QBMcRSqYZiX3QIuVbPvwzkPQIxJLL60v1/T3P7zyu47Y7YTwWnJ3gud1IBKKsnuuLABsAjqMguTDXZam6TL/ciXebr+LBLzfsWBYpJLUiyLuLktJwci5U9WUQKkOOCCoo/IvVb3X2VSl/qbCM4iaBm5Jw== tomster@smiley
  handlers:
    - name: restart ssh
      become: true
      service:
        name: ssh
        state: restarted
  pre_tasks:
    - name: install python2
      become: true
      raw: apt install -y python2.7
    - name: gather facts
      setup: # aka gather_facts
      become: true
    - name: enable root ssh login
      command: echo 'PermitRootLogin without-password' > /etc/ssh/sshd_config
      notify: restart ssh
    - name: configure SSH key for root
      become: true
      raw: echo "{{builduser_key}}" > /root/.ssh/authorized_keys
